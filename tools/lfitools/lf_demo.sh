# This script generates demo LFI data. 
# 
# Run this script from Cygwin.
#
# Usage:
#   . lf_demo.sh <startbatesnum> <endbatesnum> <samplesfilesdir> <outputdir>
#
# Example usage to generate a load file import consisting of 5 records:
#   . lf_demo.sh 1 5 test_files output
#
# Comments:
#   I would recommend using imports of up to 250,000 documents at a time.
#   A test MSG LFI of 1.5 million documents took me over 24 hours (on a VM).
#   Processing also took 24 hours.

if [ $# -ne 4 ]; then
cat <<EOI

    lf_demo.sh

    Description:
      Generate test data for LFI.

    Usage:
      . lf_demo.sh <startbatesnum> <endbatesnum> <samplefilesdir> <outputdir>

    Example:
      . lf_demo.sh 1 5 test_files output

EOI
    return 2>/dev/null || exit 99
fi

_BEGNUM=$1
_ENDNUM=$2
_SAMPLESDIR=$(cd $3 && pwd)
_OUTDIR=$4

mkdir -p $_OUTDIR || (echo "ERROR: Could not create directory $_OUTDIR" && return 1)

_SAVEDPWD=$PWD
cd $_OUTDIR

cat >loadfile.dat <<EOI
"DOCID","DOCTYPE","SENTDATE","FROM","TO","SUBJECT","NATIVE_PATH","TEXT_PATH","CUSTFIELD1","CUSTFIELD2","CUSTFIELD3","CUSTFIELD4","CUSTFIELD5","CUSTFIELD6","CUSTFIELD7"
EOI

# Generate load file.
lfgen $_BEGNUM $_ENDNUM \"%08lu\",\"Message\",\"2009-01-01T02:11:00.000+0000\",\"aiken@tamascorp.com\",\"jfredericks@tamascorp.com\",\"Test_file_%08lu\",\"native\\%08lu.msg\",\"text\\%08lu.txt\",\"11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\",\"22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\",\"33333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333\",\"44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444\",\"55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555\",\"66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\",\"77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777\" >> loadfile.dat

# Generate text and native files.
mkdir -p text native
lfcopy $(cygpath -w "$_SAMPLESDIR/test_file_text.txt") $_BEGNUM $_ENDNUM text/%08lu.txt
lfcopy $(cygpath -w "$_SAMPLESDIR/test_file_msg.msg")  $_BEGNUM $_ENDNUM native/%08lu.msg

cd $_SAVEDPWD

echo
echo "Finished!"
echo
echo "NOTE: If you have any discovery or processing issues, it could be due to permissions."
echo "      You may therefore need to reset all the file permissions using Windows Explorer."
echo
